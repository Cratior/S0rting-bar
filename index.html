<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sorting Visualizer</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: Arial, sans-serif;
      }
      #container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #barhightdiv {
        margin-top: 50px;
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-content: flex-end;
        justify-content: flex-end;
        align-items: baseline;
      }
      #bars-container {
        display: flex;
        margin-top: auto;
        width: 651px;
        align-items: flex-end;
        margin-right: -24px;
      }
      .bar {
        flex: 1;
        margin: 0 1px;
        background-color: #3498db;
        transition: height 0.2s, background-color 0.2s;
      }
      #controls {
        margin-top: 20px;
        display: flex;
        justify-content: space-around;
        width: 782px;
        background-color: #f0f0f0;
        padding: 19px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        flex-direction: row;
        flex-wrap: nowrap;
        align-content: center;
      }
      .slider-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      label {
        margin-bottom: 5px;
      }
      button {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      button#startButton {
        background-color: #4caf50;
        color: #fff;
      }
      button#stopButton {
        background-color: #f44336;
        color: #fff;
      }
      button#resetButton {
        background-color: #3498db;
        color: #fff;
      }
      #heightSlider {
        margin-left: 10px;
      }
      #algorithm {
        flex-grow: 1;
        margin-right: 10px;
      }
      #speedSlider {
        width: 70px;
        margin-right: -12px;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="barhightdiv">
        <div id="bars-container"></div>
        <div id="heightSliderdiv" class="slider-container">
          <label for="heightSlider">Height:</label>
          <input
            type="range"
            id="heightSlider"
            min="10"
            max="200"
            value="140"
            style="height: 200px; appearance: slider-vertical; margin-left: 2px"
            onchange="updateBars()"
          />
        </div>
      </div>
      <div id="controls">
        <div class="slider-container">
          <label for="barCount">Number of Bars:</label>
          <input
            type="range"
            id="barCount"
            min="5"
            max="100"
            value="30"
            onchange="updateBars()"
          />
        </div>
        <!-- New Speed Controls -->
        <div class="slider-container">
          <label for="speedSlider">Speed:</label>
          <input
            type="range"
            id="speedSlider"
            min="1"
            max="70"
            value="50"
            onchange="updateSpeed()"
          />
        </div>
        <div class="slider-container">
          <label for="algorithm">Algorithm:</label>
          <select id="algorithm" onchange="updateBars()">
            <option value="bubble">Bubble Sort</option>
            <option value="selection">Selection Sort</option>
            <option value="insertion">Insertion Sort</option>
            <option value="bogo">Bogo Sort</option>
            <option value="merge">Merge Sort</option>
            <option value="quick">Quick Sort</option>
            <option value="heap">Heap Sort</option>
            <option value="radix">Radix Sort</option>
            <option value="shell">Shell Sort</option>
          </select>
        </div>
        <div
          style="
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-content: center;
            justify-content: space-around;
            align-items: stretch;
            width: 30%;
          "
        >
          <button
            id="startButton"
            style="padding: 3px 21px; margin: 5px"
            onclick="startSorting()"
          >
            Start
          </button>
          <button
            id="stopButton"
            style="padding: 3px 21px; margin: 5px"
            onclick="stopSorting()"
          >
            Stop
          </button>
          <button
            id="resetButton"
            style="padding: 3px 21px; margin: 5px"
            onclick="resetBars()"
          >
            Reset
          </button>
        </div>
      </div>
    </div>
    <script>
      let bars = [];
      let sorting = false;
      let speed = 50; // Default speed value
      function generateBars(count, maxHeight) {
        const barHeightIncrement = maxHeight / count;
        bars = Array.from(
          { length: count },
          (_, index) => (index + 1) * barHeightIncrement
        );
        bars = shuffle(bars);
        renderBars();
      }
      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      function renderBars() {
        const barsContainer = document.getElementById("bars-container");
        barsContainer.innerHTML = "";
        bars.forEach((height, index) => {
          const bar = document.createElement("div");
          bar.className = "bar";
          bar.style.height = `${height}px`;
          barsContainer.appendChild(bar);
        });
      }
      function updateBars() {
        if (!sorting) {
          const barCount = document.getElementById("barCount").value;
          const maxHeight = document.getElementById("heightSlider").value;
          generateBars(barCount, maxHeight);
        }
      }
      function updateSpeed() {
        speed = document.getElementById("speedSlider").value;
      }
      function startSorting() {
        if (!sorting) {
          const selectedAlgorithm = document.getElementById("algorithm").value;
          sorting = true;
          switch (selectedAlgorithm) {
            case "bubble":
              bubbleSort();
              break;
            case "selection":
              selectionSort();
              break;
            case "insertion":
              insertionSort();
              break;
            case "bogo":
              bogoSort();
              break;
            case "merge":
              mergeSort();
              break;
            case "quick":
              quickSort();
              break;
            case "heap":
              heapSort();
              break;
            case "radix":
              radixSort();
              break;
            case "shell":
              shellSort();
              break;
          }
        }
      }

      function stopSorting() {
    sorting = false;
    resetHighlight(); // Add this line to reset the highlighted bars
}
function resetHighlight() {
    const barsContainer = document.getElementById("bars-container");
    const n = bars.length;
    for (let i = 0; i < n; i++) {
        barsContainer.children[i].style.backgroundColor = "#3498db";
    }
}

      function resetBars() {
        stopSorting();
        const barCount = document.getElementById("barCount").value;
        const maxHeight = document.getElementById("heightSlider").value;
        generateBars(barCount, maxHeight);
        resetHighlight();
      }
      function delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }
      async function bubbleSort() {
        for (let i = 0; i < bars.length - 1; i++) {
          for (let j = 0; j < bars.length - i - 1; j++) {
            if (!sorting) return;
            if (bars[j] > bars[j + 1]) {
              [bars[j], bars[j + 1]] = [bars[j + 1], bars[j]];
              renderBars();
              highlightBars(j, j + 1, "red");
              await delay(speed);
            }
          }
        }
        checkBars();
        sorting = false;
      }
      async function bogoSort() {
    const isSorted = () => {
        for (let i = 0; i < bars.length - 1; i++) {
            if (bars[i] > bars[i + 1]) {
                return false;
            }
        }
        return true;
    };

    while (!isSorted() && sorting) {
        // Highlight all bars in red
        for (let i = 0; i < bars.length; i++) {
            highlightBars(i, null, 'red');
        }

        bars = shuffle(bars);
        renderBars();
        await delay(speed);
    }

    // Highlight all bars in green when sorted
    for (let i = 0; i < bars.length; i++) {
        highlightBars(i, null, 'green');
    }

    checkBars();
    sorting = false;
}


      async function selectionSort() {
        const n = bars.length;
        for (let i = 0; i < n - 1; i++) {
          let minIndex = i;
          for (let j = i + 1; j < n; j++) {
            if (!sorting) return;
            if (bars[j] < bars[minIndex]) {
              minIndex = j;
            }
          }
          [bars[i], bars[minIndex]] = [bars[minIndex], bars[i]];
          renderBars();
          highlightBars(i, minIndex, "red");
          await delay(speed);
        }
        checkBars();
        sorting = false;
      }
      async function insertionSort() {
        const n = bars.length;
        for (let i = 1; i < n; i++) {
          if (!sorting) return;
          const key = bars[i];
          let j = i - 1;
          while (j >= 0 && bars[j] > key) {
            bars[j + 1] = bars[j];
            j--;
          }
          bars[j + 1] = key;
          renderBars();
          highlightBars(j + 1, i, "red");
          await delay(speed);
        }
        checkBars();
        sorting = false;
      }
      async function mergeSort() {
        if (bars.length <= 1) return bars;

        const merge = async (left, right) => {
          let result = [];
          let leftIndex = 0;
          let rightIndex = 0;

          while (leftIndex < left.length && rightIndex < right.length) {
            if (left[leftIndex] < right[rightIndex]) {
              result.push(left[leftIndex]);
              leftIndex++;
            } else {
              result.push(right[rightIndex]);
              rightIndex++;
            }
          }

          return result
            .concat(left.slice(leftIndex))
            .concat(right.slice(rightIndex));
        };

        const mergeSortRecursive = async (array) => {
          if (array.length <= 1) return array;

          const middle = Math.floor(array.length / 2);
          const left = array.slice(0, middle);
          const right = array.slice(middle);

          const leftSorted = await mergeSortRecursive(left);
          const rightSorted = await mergeSortRecursive(right);

          return await merge(leftSorted, rightSorted);
        };

        const sortedArray = await mergeSortRecursive(bars);
        bars = sortedArray;
        renderBars();
      }

      async function quickSort() {
        const partition = async (low, high) => {
          const pivot = bars[high];
          let i = low - 1;

          for (let j = low; j < high; j++) {
            if (!sorting) return;

            if (bars[j] < pivot) {
              i++;
              [bars[i], bars[j]] = [bars[j], bars[i]];
              renderBars();
              highlightBars(i, j, "red");
              await delay(speed);
            }
          }

          [bars[i + 1], bars[high]] = [bars[high], bars[i + 1]];
          renderBars();
          highlightBars(i + 1, high, "red");
          await delay(speed);

          return i + 1;
        };

        const quickSortRecursive = async (low, high) => {
          if (low < high) {
            const partitionIndex = await partition(low, high);

            await quickSortRecursive(low, partitionIndex - 1);
            await quickSortRecursive(partitionIndex + 1, high);
          }
        };

        await quickSortRecursive(0, bars.length - 1);
        checkBars();
        sorting = false;
      }

      async function heapSort() {
        const heapify = async (n, i) => {
          let largest = i;
          const left = 2 * i + 1;
          const right = 2 * i + 2;

          if (left < n && bars[left] > bars[largest]) {
            largest = left;
          }

          if (right < n && bars[right] > bars[largest]) {
            largest = right;
          }

          if (largest !== i) {
            [bars[i], bars[largest]] = [bars[largest], bars[i]];
            renderBars();
            highlightBars(i, largest, "red");
            await delay(speed);

            await heapify(n, largest);
          }
        };

        const heapSortAlgorithm = async () => {
          const n = bars.length;

          for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
            await heapify(n, i);
          }

          for (let i = n - 1; i > 0; i--) {
            if (!sorting) return;

            [bars[0], bars[i]] = [bars[i], bars[0]];
            renderBars();
            highlightBars(0, i, "red");
            await delay(speed);

            await heapify(i, 0);
          }
        };

        await heapSortAlgorithm();
        checkBars();
        sorting = false;
      }

      async function radixSort() {
        const getMax = () => {
          let max = bars[0];

          for (let i = 1; i < bars.length; i++) {
            if (bars[i] > max) {
              max = bars[i];
            }
          }

          return max;
        };

        const countingSort = async (exp) => {
          const n = bars.length;
          const output = new Array(n).fill(0);
          const count = new Array(10).fill(0);

          for (let i = 0; i < n; i++) {
            count[Math.floor(bars[i] / exp) % 10]++;
          }

          for (let i = 1; i < 10; i++) {
            count[i] += count[i - 1];
          }

          for (let i = n - 1; i >= 0; i--) {
            if (!sorting) return;

            const targetIndex = count[Math.floor(bars[i] / exp) % 10] - 1;

            // Highlight bars for comparison
            highlightBars(i, targetIndex, "red");
            await delay(speed);

            output[targetIndex] = bars[i];
            count[Math.floor(bars[i] / exp) % 10]--;
          }

          for (let i = 0; i < n; i++) {
            bars[i] = output[i];
            renderBars();
            await delay(speed);
          }
        };

        const radixSortAlgorithm = async () => {
          const max = getMax();

          for (let exp = 1; Math.floor(max / exp) > 0; exp *= 10) {
            await countingSort(exp);
          }
        };

        await radixSortAlgorithm();
        checkBars();
        sorting = false;
      }

      async function shellSort() {
        const shellSortAlgorithm = async () => {
          const n = bars.length;
          for (
            let gap = Math.floor(n / 2);
            gap > 0;
            gap = Math.floor(gap / 2)
          ) {
            for (let i = gap; i < n; i += 1) {
              if (!sorting) return;

              const temp = bars[i];
              let j = i;

              while (j >= gap && bars[j - gap] > temp) {
                bars[j] = bars[j - gap];
                renderBars();
                highlightBars(j, j - gap, "red");
                await delay(speed);

                j -= gap;
              }

              bars[j] = temp;
              renderBars();
              highlightBars(j, i, "red");
              await delay(speed);
            }
          }
        };

        await shellSortAlgorithm();
        checkBars();
        sorting = false;
      }
      function highlightBars(index1, index2, color) {
    const barsContainer = document.getElementById("bars-container");
    
    if (index1 !== null && index1 >= 0 && index1 < barsContainer.children.length) {
        const bar1 = barsContainer.children[index1];
        bar1.style.backgroundColor = color;
    }

    if (index2 !== null && index2 >= 0 && index2 < barsContainer.children.length) {
        const bar2 = barsContainer.children[index2];
        bar2.style.backgroundColor = color;
    }
}

      async function checkBars() {
        const barsContainer = document.getElementById("bars-container");
        const n = bars.length;
        for (let i = 0; i < n - 1; i++) {
          if (bars[i] > bars[i + 1]) {
            // Highlight the problematic bar in red
            barsContainer.children[i].style.backgroundColor = "red";
            await delay(12);
            barsContainer.children[i].style.backgroundColor = "#3498db"; // Reset color
            return;
          }
          // Highlight the current bar in green
          barsContainer.children[i].style.backgroundColor = "green";
          await delay(12);
        }
        // Highlight the last bar in green
        barsContainer.children[n - 1].style.backgroundColor = "green";
      }
      function resetHighlight() {
        const barsContainer = document.getElementById("bars-container");
        const n = bars.length;
        for (let i = 0; i < n; i++) {
          barsContainer.children[i].style.backgroundColor = "#3498db";
        }
      }
      // Initial setup
      generateBars(30, 140);
    </script>
  </body>
</html>
